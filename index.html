<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Happy Birthday ♥</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#070407;
      --card-width:900px;
      --card-height:560px;
      --accent:#dc143c; /* crimson */
      --accent-dark:#8b0000;
      --paper:#fafafa;
      --glass: rgba(255,255,255,0.04);
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Roboto,system-ui,-apple-system,Segoe UI,Arial;}
    body{
      background:
        radial-gradient(1000px 480px at 10% 10%, rgba(140,0,0,0.06), transparent),
        linear-gradient(180deg, rgba(10,7,12,1) 0%, rgba(20,12,20,1) 100%);
      display:flex;align-items:center;justify-content:center;padding:20px;
      color:#fff;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      overflow:hidden;
    }

    /* Stage & envelope */
    .stage{
      width:100%;
      max-width:var(--card-width);
      height:var(--card-height);
      position:relative;
      perspective:1200px;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .envelope{
      width:86%;
      max-width:820px;
      height:70%;
      max-height:420px;
      position:relative;
      transform-style:preserve-3d;
      transition:transform .8s cubic-bezier(.2,.95,.2,1);
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }

    /* Envelope bottom (body) */
    .env-bottom{
      position:absolute;
      left:0;right:0;bottom:0;
      height:62%;
      background: linear-gradient(180deg, #141216, #1b0f12);
      border-radius:12px;
      transform-origin:top center;
      box-shadow: 0 12px 40px rgba(0,0,0,0.8), inset 0 -4px 14px rgba(220,20,60,0.06);
      z-index:1;
      padding-top:36%;
      display:flex;align-items:flex-start;justify-content:center;
      overflow:hidden;
    }

    /* Flap */
    .env-flap{
      position:absolute;
      left:0;right:0;top:0;
      height:62%;
      transform-origin:top center;
      z-index:6;
      display:flex;align-items:center;justify-content:center;
      transition:transform .9s cubic-bezier(.2,.95,.2,1);
      pointer-events:none;
      -webkit-backface-visibility:hidden;
      backface-visibility:hidden;
    }
    .env-flap .triangle{
      width:100%;
      height:100%;
      clip-path: polygon(50% 0, 100% 50%, 50% 100%, 0 50%);
      background: linear-gradient(180deg, #2b0b11 0%, #11060a 100%);
      border-radius:10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.85), inset 0 -6px 14px rgba(220,20,60,0.09);
    }

    /* Seal */
    .seal{
      position:absolute;
      left:50%;
      top:22%;
      transform:translateX(-50%);
      width:92px;height:92px;
      border-radius:50%;
      background: radial-gradient(circle at 30% 30%, #ff6b85, #dc143c 55%, #8b0000 100%);
      display:flex;align-items:center;justify-content:center;
      z-index:9;
      box-shadow:0 10px 40px rgba(220,20,60,0.35), 0 0 40px rgba(220,20,60,0.12);
      transition:transform .7s cubic-bezier(.2,.95,.2,1),opacity .6s;
      pointer-events:none;
    }

    /* Paper inside */
    .paper{
      position:absolute;
      left:50%;
      top:52%;
      transform:translate(-50%,-44%) scale(.98);
      width:86%;
      height:68%;
      background: linear-gradient(135deg, #fff 0%, #f6f3f3 100%);
      border-radius:12px;
      box-shadow: 0 20px 48px rgba(0,0,0,0.7), inset 0 1px 0 rgba(255,255,255,0.9);
      z-index:3;
      padding:34px 42px;
      opacity:0;
      transform-origin:top center;
      transition:all .9s cubic-bezier(.2,.95,.2,1);
      overflow:auto;
      pointer-events:none;
      display:flex;
      flex-direction:column;
      color:#222;
    }

    .heading{
      font-family:'Great Vibes', cursive;
      font-size:48px;
      color:var(--accent-dark);
      margin:2px 0 6px 0;
      letter-spacing:0.5px;
    }

    .sub{
      font-size:18px;color:#6b2a2a;margin-bottom:14px;
    }

    .message{
      font-size:15px;line-height:1.6;color:#333;max-width:720px;
      flex-grow:1;
    }

    .open-button {
      margin-top:18px;
      align-self:center;
      background: linear-gradient(180deg, rgba(220,20,60,1), rgba(140,0,0,1));
      color:white;
      padding:10px 18px;
      border-radius:24px;
      font-weight:700;
      border:0;
      cursor:pointer;
      box-shadow: 0 8px 24px rgba(140,0,0,0.35), 0 0 30px rgba(220,20,60,0.08);
    }

    .hint{
      position:absolute;left:50%;bottom:-44px;transform:translateX(-50%);
      color:rgba(230,238,252,0.95);font-weight:600;font-size:14px;padding:8px 14px;border-radius:20px;background:rgba(220,20,60,0.06);
      border:1px solid rgba(220,20,60,0.18);
      backdrop-filter: blur(4px);
      transition:opacity .6s;
      z-index:12;
    }

    /* Sparkles container */
    .sparkles{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index:15;
      overflow:visible;
    }

    /* Envelope opened state */
    .envelope.open .env-flap{ transform: rotateX(180deg) translateY(-8px); }
    .envelope.open .env-bottom{ transform: translateY(8px); }
    .envelope.open .seal{ transform: translate(-50%, -14px) scale(.68) rotate(-8deg); opacity:.96; }
    .envelope.open .paper{ opacity:1; transform:translate(-50%,-58%) scale(1); z-index:11; pointer-events:auto; }

    /* Soft glow when opened */
    .glow {
      position:absolute;
      left:50%;
      top:28%;
      transform:translate(-50%,-12%);
      width:360px;height:180px;border-radius:50%;
      background: radial-gradient(circle at 50% 40%, rgba(220,20,60,0.18) 0%, rgba(140,0,0,0.06) 30%, transparent 60%);
      filter: blur(8px);
      z-index:7;
      opacity:0;
      transition:opacity .7s ease;
      pointer-events:none;
    }
    .envelope.open ~ .glow, .envelope.open .glow { opacity:1; }

    /* Petals */
    .petal {
      position:fixed;
      top:-10vh;
      width:20px;height:24px;
      background:linear-gradient(180deg, #ff9eb0 0%, #dc143c 80%);
      border-radius:50% 50% 40% 60% / 60% 60% 40% 40%;
      transform-origin:center;
      opacity:0.95;
      z-index:4;
      pointer-events:none;
      will-change:transform, top, left;
      filter: drop-shadow(0 6px 8px rgba(0,0,0,0.35));
    }

    /* Petal animation is set via inline styles for randomness; fallback keyframes */
    @keyframes fall {
      0% { transform: translateY(-10vh) rotate(0deg); opacity:0; }
      8% { opacity:1; }
      100% { transform: translateY(110vh) rotate(720deg); opacity:0.95; }
    }

    /* sparkles (small twinkles) */
    .spark {
      position:absolute;
      width:6px;height:6px;border-radius:50%;
      background: radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,0.6) 40%, transparent 60%);
      box-shadow:0 0 12px rgba(255,220,220,0.9);
      opacity:0;
      transform:scale(.3);
      pointer-events:none;
      z-index:16;
      animation: twinkle 1.6s linear infinite;
    }
    @keyframes twinkle {
      0%{opacity:0; transform:scale(.2) rotate(0);}
      20%{opacity:1; transform:scale(1) rotate(30deg);}
      80%{opacity:0.6; transform:scale(.7) rotate(80deg);}
      100%{opacity:0; transform:scale(.2) rotate(120deg);}
    }

    /* Surprise page overlay */
    .surprise {
      position:fixed;
      inset:0;
      background: radial-gradient(800px 400px at 70% 20%, rgba(120,0,0,0.18), transparent),
                  linear-gradient(180deg, rgba(8,2,6,0.95), rgba(12,6,10,0.98));
      display:flex;align-items:center;justify-content:center;
      padding:28px;
      z-index:40;
      opacity:0;
      pointer-events:none;
      transition:opacity .9s ease;
    }
    .surprise.show {
      opacity:1;
      pointer-events:auto;
    }

    .surprise-card{
      width:100%;
      max-width:820px;
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      border-radius:18px;
      padding:32px;
      box-shadow: 0 30px 80px rgba(0,0,0,0.75), 0 0 40px rgba(139,0,0,0.08) inset;
      border:1px solid rgba(255,255,255,0.04);
      color:#ffdfe6;
      text-align:center;
      position:relative;
      overflow:hidden;
    }

    .surprise-card h2 {
      font-family:'Great Vibes', cursive;
      font-size:56px;
      margin:6px 0 8px 0;
      color:#ffb6c1;
      text-shadow: 0 6px 26px rgba(140,0,0,0.5);
    }

    .surprise-card p {
      font-size:18px;
      line-height:1.6;
      margin:10px 0 18px;
      color:#ffe9ef;
    }

    .close-btn {
      margin-top:12px;
      background:transparent;
      border:1px solid rgba(255,255,255,0.12);
      color:#ffdfe6;
      padding:8px 14px;
      border-radius:18px;
      cursor:pointer;
    }

    /* small screens */
    @media (max-width:720px){
      :root{--card-height:520px;--card-width:680px;}
      .heading{font-size:36px}
      .paper{padding:18px}
      .seal{width:72px;height:72px;top:18%}
      .surprise-card h2{font-size:42px}
    }
  </style>
</head>

<body>

  <!-- Background song -->
  <audio id="bgm" loop preload="auto" playsinline>
    <source src="happy-birthday.mp3" type="audio/mp3">
    <!-- fallback text for browsers that don't support audio -->
  </audio>

  <div class="stage" aria-live="polite">
    <div id="envelope" class="envelope" role="button" aria-pressed="false" tabindex="0" aria-label="Birthday envelope. Click to open.">
      <div class="env-bottom" aria-hidden="true"></div>

      <div class="env-flap" aria-hidden="true">
        <div class="triangle"></div>
      </div>

      <div class="seal" aria-hidden="true" title="sealed with love">
        <!-- small heart svg -->
        <svg width="44" height="44" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M12 20s-7.2-4.5-9.1-7.1C-0.4 8.5 4.6 5 7.4 7.7 9 9 12 12 12 12s3-3 4.6-4.3C19.4 5 24.4 8.5 21.1 12.9 19.2 15.5 12 20 12 20z" fill="#fff" opacity="0.06"/>
          <path d="M12 8.6c-1.2-2-3.9-2.1-5.4-.6-1.7 1.6-1.3 4.3 1.5 7.4 2.7 3.1 5.1 4.1 5.1 4.1s2.4-1 5.1-4.1c2.8-3.1 3.2-5.8 1.5-7.4-1.6-1.5-4.2-1.3-5.4.6L12 8.6z" fill="#fff"/>
        </svg>
      </div>

      <div class="paper" id="paper" aria-hidden="true">
        <div style="font-size:12px;color:#7b8aa8">01 · 12 · 2025</div>

        <h1 class="heading">Happy Birthday Mahal Ko</h1>

        <div class="sub">I’m so happy to celebrate this day with you.</div>

        <div class="message" id="message">
          <strong style="font-size:16px">Dear Aivan,</strong><br><br>
          Happy birthday sa pinakamahal ko sa mundo. Ngayon, December 1st, is the day I get to celebrate the existence ng isang taong nag-transform sa buhay ko in ways I never thought possible.
          <br><br>
          Totoo, hindi ako makahanap ng perfect words pero try ko lang. Every single day with you, nakikita ko kung gaano ka-special. The way you laugh, the way you care about things even when the world doesn't, the gentleness na dala mo sa mundo kahit meron kang sariling struggles. You're the kind of person na kapag nandyan ka, parang everything's gonna be okay.
          <br><br>
          This year, gusto ko na everything you've been dreaming of comes true. You deserve all the happiness in the universe. I want you to know na I'm here, always. Through happy moments, through confusing times, through whatever comes our way. I'm choosing you, not just today, but every single day after. Thank you for being you, for loving me the way you do, for making ordinary days feel extraordinary.
          <br><br>
          Forever yours,<br>
          <em style="font-family:'Great Vibes',cursive;font-size:20px">Nathalie</em>
        </div>

        <button class="open-button" id="open-surprise" aria-label="Open surprise">Open Surprise</button>
      </div>
    </div>

    <div id="hint" class="hint">Tap to open</div>

    <!-- glow -->
    <div class="glow" aria-hidden="true"></div>

    <!-- sparkles layer -->
    <div class="sparkles" id="sparkles" aria-hidden="true"></div>

  </div>

  <!-- Surprise overlay (Romantic Night theme) -->
  <div class="surprise" id="surprise" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="surprise-card" role="document">
      <h2>To My Beloved</h2>
      <p>
        On this night the stars carry my whisper to you — thank you for being my quiet home and wild adventure all at once.
        My heart chooses you, today and every day. Maligayang kaarawan, aking mahal.
      </p>

      <div style="display:flex;gap:10px;justify-content:center;align-items:center;">
        <button class="close-btn" id="close-surprise" aria-label="Close surprise">Close</button>
        <button class="open-button" id="replay-music" style="padding:8px 12px;">Replay Song</button>
      </div>
    </div>
  </div>

  <script>
    /****************************
     * Elements
     ****************************/
    const envelope = document.getElementById('envelope');
    const hint = document.getElementById('hint');
    const bgm = document.getElementById('bgm');
    const paper = document.getElementById('paper');
    const openSurpriseBtn = document.getElementById('open-surprise');
    const surprise = document.getElementById('surprise');
    const closeSurpriseBtn = document.getElementById('close-surprise');
    const replayMusicBtn = document.getElementById('replay-music');
    const sparklesContainer = document.getElementById('sparkles');

    let opened = false;
    let petalsLaunched = false;

    // Helper to try playing audio (wrapped for browsers)
    function tryPlayAudio() {
      bgm.currentTime = 0;
      const p = bgm.play();
      if (p && p.catch) p.catch(()=>{/* ignore */});
    }

    /* Open envelope: show paper, glow, sparkles, play music,
       animate a short sequence of sparkles/petals. */
    function openEnvelope() {
      if (opened) return;
      opened = true;
      envelope.classList.add('open');
      envelope.setAttribute('aria-pressed','true');
      hint.style.opacity = 0;
      paper.setAttribute('aria-hidden','false');

      // small delay so the flap animation starts first, then music/petals
      setTimeout(() => {
        tryPlayAudio();
        launchPetals(30);
        createSparkles(14);
      }, 140);

      // for accessibility announce
      envelope.setAttribute('aria-label', 'Envelope opened. Press "Open Surprise" to continue.');
    }

    envelope.addEventListener('click', openEnvelope);
    envelope.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' ') { e.preventDefault(); openEnvelope(); } });

    // Also allow a first-anywhere click to trigger music if autoplay blocked
    document.addEventListener('click', function onDocClick() {
      if (opened) tryPlayAudio();
      document.removeEventListener('click', onDocClick);
    });

    /****************************
     * Falling petals generator
     ****************************/
    function launchPetals(count=20) {
      if (petalsLaunched) return;
      petalsLaunched = true;
      const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);

      for (let i=0;i<count;i++){
        const petal = document.createElement('div');
        petal.className = 'petal';
        // randomize size
        const size = randRange(14,40);
        petal.style.width = size + 'px';
        petal.style.height = Math.round(size * 1.15) + 'px';
        // random initial left across viewport
        const startLeft = randRange(-10, vw + 10);
        petal.style.left = startLeft + 'px';
        // random rotation & transform origin
        const rot = randRange(0,360);
        petal.style.transform = `rotate(${rot}deg)`;
        // create a little notch to look like a petal by using border-radius already set in CSS

        // random animation duration and delay
        const duration = randRange(4000, 8500); // ms
        const delay = randRange(0, 1400);

        // animate using CSS keyframes via style property fallback
        petal.style.animation = `fall ${duration}ms linear ${delay}ms both`;

        // also apply slight horizontal drift via CSS transitions updated by JS
        const drift = randRange(-80, 80);
        petal.style.setProperty('--drift', drift + 'px');

        // add slight individual wiggle using CSS transform in steps by adding an inner rotation with animation
        const wiggle = randRange(2000, 7000);
        petal.style.willChange = 'transform, left, top';
        // random opacity
        petal.style.opacity = (randRange(70, 98) / 100).toString();

        document.body.appendChild(petal);

        // Add small random horizontal oscillation by animating left over time using requestAnimationFrame
        animatePetal(petal, startLeft, drift, duration + delay);

        // remove after animation to keep DOM clean
        setTimeout(()=>{ petal.remove(); }, duration + delay + 800);
      }
    }

    function animatePetal(el, startLeft, drift, ttl) {
      const start = performance.now();
      const initialTop = -100; // px (above viewport)
      const distance = window.innerHeight + 300;
      const amplitude = randRange(20, 120);
      const frequency = randRange(800, 2600);

      function frame(t){
        const elapsed = t - start;
        if (elapsed > ttl) return;
        const progress = Math.min(1, elapsed / ttl);
        // vertical position (px)
        const top = initialTop + distance * progress;
        // horizontal oscillation
        const x = startLeft + drift * progress + amplitude * Math.sin((elapsed / frequency) * Math.PI * 2);
        const rotate = progress * 720 * (Math.random() > 0.5 ? 1 : -1);
        el.style.top = top + 'px';
        el.style.left = x + 'px';
        el.style.transform = `rotate(${rotate}deg)`;
        requestAnimationFrame(frame);
      }
      requestAnimationFrame(frame);
    }

    function randRange(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    /****************************
     * Sparkles generator
     ****************************/
    function createSparkles(n = 12) {
      const rect = envelope.getBoundingClientRect();
      const baseLeft = rect.left + rect.width/2;
      const baseTop = rect.top + rect.height/3;

      for (let i=0;i<n;i++){
        const s = document.createElement('div');
        s.className = 'spark';
        // random placement around top of envelope
        const offsetX = randRange(-rect.width/2, rect.width/2);
        const offsetY = randRange(-rect.height/4, rect.height/3);
        s.style.left = (baseLeft + offsetX) + 'px';
        s.style.top = (baseTop + offsetY) + 'px';
        // stagger animation slightly with negative delay
        s.style.animationDelay = (Math.random() * 0.8).toFixed(2) + 's';
        // scale sparkle size
        const size = randRange(4,10);
        s.style.width = s.style.height = size + 'px';
        sparklesContainer.appendChild(s);
        // remove after a while for cleanliness
        setTimeout(()=> s.remove(), 6000 + Math.random()*2400);
      }
    }

    /****************************
     * Surprise overlay controls
     ****************************/
    openSurpriseBtn.addEventListener('click', (e) => {
      // show surprise overlay (fade)
      surprise.classList.add('show');
      surprise.setAttribute('aria-hidden','false');
      // small focus trap to the close button
      closeSurpriseBtn.focus();
    });

    closeSurpriseBtn.addEventListener('click', (e) => {
      surprise.classList.remove('show');
      surprise.setAttribute('aria-hidden','true');
      // return focus to open surprise
      openSurpriseBtn.focus();
    });

    replayMusicBtn.addEventListener('click', (e) => {
      tryPlayAudio();
    });

    // allow escape to close surprise
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && surprise.classList.contains('show')) {
        surprise.classList.remove('show');
        surprise.setAttribute('aria-hidden','true');
        openSurpriseBtn.focus();
      }
    });


    /****************************
     * Small progressive flair on load
     ****************************/
    // subtle entry hint fade
    window.addEventListener('load', () => {
      setTimeout(()=> {
        hint.style.opacity = 1;
      }, 450);
      // initial tiny sparkles in background
      setTimeout(()=> createSparkles(6), 800);
    });

    /****************************
     * Improve mobile UX:
     * Unlock audio on user gesture if autoplay blocked
     ****************************/
    function unlockAudioOnFirstGesture() {
      try {
        bgm.play().then(()=> {
          bgm.pause();
          bgm.currentTime = 0;
        }).catch(()=>{ /* ignore */ });
      } catch(e){}
      document.removeEventListener('touchstart', unlockAudioOnFirstGesture);
      document.removeEventListener('click', unlockAudioOnFirstGesture);
    }
    document.addEventListener('touchstart', unlockAudioOnFirstGesture, {passive:true});
    document.addEventListener('click', unlockAudioOnFirstGesture, {once:true});

    /****************************
     * Accessibility: allow keyboard to open envelope
     ****************************/
    // Envelope key handler already above; ensure focus visible styling (browser default is fine).

  </script>

</body>
</html>
